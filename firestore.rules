/**
 * Core Philosophy:
 * This ruleset is designed for a public-facing portfolio or marketing website.
 * The primary goal is to make informational content (like clients, services, and
 * process steps) publicly readable by anyone. Write operations are restricted to
 * authenticated users, who are considered administrators for content management.
 * A dedicated collection for contact form submissions is configured to be write-only for any visitor.
 *
 * Data Structure:
 * The data is organized into four distinct, top-level collections:
 * - /clients/{clientId}: Publicly viewable client information.
 * - /services/{serviceId}: Publicly viewable service offerings.
 * - /funnel_steps/{funnelStepId}: Publicly viewable funnel/process steps.
 * - /contact_form_submissions/{submissionId}: Private, write-only submissions.
 *
 * Key Security Decisions:
 * - Public Read, Admin Write: All informational collections (/clients, /services,
 *   /funnel_steps) are publicly readable. Write access is restricted to any user
 *   who is signed in, effectively treating all authenticated users as admins.
 * - Write-Only Ingress: The /contact_form_submissions collection is intentionally
 *   configured to allow anyone to create a document but denies all read, update,
 *   and delete operations. This protects the privacy of submitted user data (PII)
 *   while providing a secure endpoint for data collection.
 * - Default Secure: The default security posture is to deny all access unless
 *   explicitly granted.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ----------------------------------------------------------------------
    // Helper Functions
    // ----------------------------------------------------------------------

    /**
     * Checks if a user is authenticated.
     */
    function isSignedIn() {
      return request.auth != null;
    }

    /**
     * For this application, any signed-in user is considered an admin.
     * In a more complex app, this would check for specific custom claims.
     */
    function isAdmin() {
      return isSignedIn();
    }

    // ----------------------------------------------------------------------
    // Collection Rules
    // ----------------------------------------------------------------------

    /**
     * @description Manages public information about company clients.
     * Anyone can read this data, but only an administrator can modify it.
     * @path /clients/{clientId}
     * @allow (get, list) Any user, signed in or not, can read client documents.
     * @allow (create, update, delete) Only authenticated users (admins) can write.
     * @principle Public read for marketing content, with writes restricted to admins.
     */
    match /clients/{clientId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    /**
     * @description Manages public information about company services.
     * Anyone can read this data, but only an administrator can modify it.
     * @path /services/{serviceId}
     * @allow (get, list) Any user, signed in or not, can read service documents.
     * @allow (create, update, delete) Only authenticated users (admins) can write.
     * @principle Public read for marketing content, with writes restricted to admins.
     */
    match /services/{serviceId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    /**
     * @description Manages public information about the company's process/funnel.
     * Anyone can read this data, but only an administrator can modify it.
     * @path /funnel_steps/{funnelStepId}
     * @allow (get, list) Any user, signed in or not, can read funnel step documents.
     * @allow (create, update, delete) Only authenticated users (admins) can write.
     * @principle Public read for marketing content, with writes restricted to admins.
     */
    match /funnel_steps/{funnelStepId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    /**
     * @description A write-only collection for receiving contact form messages.
     * Any user (including anonymous visitors) can create a submission, but no one
     * can read, update, or delete any data to protect user privacy.
     * @path /contact_form_submissions/{contactFormSubmissionId}
     * @allow (create) An anonymous website visitor submits the contact form.
     * @deny (read, update, delete) All other operations are denied to protect PII.
     * @principle Enforces a secure data ingress pattern for public forms, protecting PII.
     */
    match /contact_form_submissions/{contactFormSubmissionId} {
      allow read, update, delete: if false;
      allow create: if true;
    }
  }
}
